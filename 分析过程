隐藏进程之内核版

任务管理器遍历进程是使用CreateToolhelp32Snapshot()API创建快照遍历查找的，使用快照的API在内核中就是通过访问一个双向链表的数据结构来得到每一个进程的信息的，那么我们只要把需要隐藏的进程信息从这个链表中删除，就能完成隐藏的目的。

每个进程在内核中都有一个内核对象，内核对象的信息被保存在一个名为EPROCESS的结构体中，首先进行双机调试，在这我调试的是WIN7虚拟机，在windbg调试器中输入dt _eprocess指令即可查看EPROCESS结构体 在这里要注意的是偏移0xb8的一个字段：+0x0b8 ActiveProcessLinks : _LIST_ENTRY

这个字段记录的就是当前系统上的活动进程链表, 通过遍历这条链表就能得到当前系统上的所有进程。 在隐藏进程时还需关注的一个字段是在偏移为0x16c处的一个字段：+0x16c ImageFileName : [15] UChar

这个字段记录的当前进程的名称字符串的地址。当然上面这两个的字段的偏移并不是固定的，在不同版本的系统中偏移有可能不同，所以使用时要查看该系统的字段偏移。

LIST_ENTRY是一个双向链表，只要操作LIST_ENTRY这个双向链表，我们就可以遍历系统上的全部进程。在隐藏进程中，我们只要通过链表操作，对比进程名称，找到我们想隐藏的程序，把它从这个链表中删除。
